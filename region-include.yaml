# template-region
fork from longlight
# 全局配置 
port: 7890
socks-port: 7891
redir-port: 7892
mixed-port: 7893
tproxy-port: 7894
allow-lan: true
bind-address: "*"
ipv6: false
unified-delay: true
tcp-concurrent: true
# interface-name: enp6s18
log-level: warning
find-process-mode: 'off'
global-client-fingerprint: chrome
keep-alive-idle: 600
keep-alive-interval: 15
profile:
  store-selected: true
  store-fake-ip: true

# 为防止使用插件朋友遇到面板问题，我注释掉了此模块。
# 跑裸核朋友自行删除注释即可，使用nikki仅内核的ui路径改为/etc/nikki/run/ui
#external-controller: 0.0.0.0:9090
#secret: ""
#external-ui: "/etc/mihomo/ui"
#external-ui-name: zashboard
#external-ui-url: "https://github.com/Zephyruso/zashboard/archive/refs/heads/gh-pages.zip"

# 嗅探
sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  force-domain:
    - "+.v2ex.com"
  skip-domain:
    - "+.baidu.com"

# 入站  
tun:
  enable: true
  # system/gvisor/mixed
  stack: mixed
  dns-hijack: ["any:53", "tcp://any:53"]
  #使用nikki，混入全部不修改的情况，开启接口指定为nikki
  #使用仅内核自行修改下面三项为true
  #device: nikki
  auto-route: false
  auto-redirect: false
  auto-detect-interface: false
#统一延迟测速和tcp并发
unified-delay: true
tcp-concurrent: true
#dns配置
dns:
  enable: true
  use-hosts: true
  use-system-hosts: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  respect-rules: true
  nameserver:
    - 1.1.1.1
    - 8.8.8.8
  proxy-server-nameserver:
    - 119.29.29.29
    - 114.114.114.114
  nameserver-policy:
    "rule-set:cnsite":
    - 119.29.29.29
    - 114.114.114.114
  fake-ip-filter:
    #本地网络及保留域名
    - "*.lan"
    - "*.local"
    - "*.localhost"
    - "*.localdomain"
    - "*.home.arpa"
    - "*.invalid"
    - "+.miwifi.com"
    - "+.msftconnecttest.com"
    - "+.msftncsi.com"
    #NTP 时间同步服务
    - "+.pool.ntp.org"
    - "time.*.com"
    - "time.*.gov"
    - "time.*.edu.cn"
    - "time.*.apple.com"
    - "time-ios.apple.com"
    - "ntp.*.com"
    - "*.ntp.org.cn"
    - "*.time.edu.cn"
    #STUN 服务
    - "+.stun"
    - turn.cloudflare.com
    - "+.rustdesk.com"
    #Google
    - "lens.l.google.com"
    #米家物联网
    - "Mijia Cloud"
    #快捷登录
    - "graph.qq.com"
    - "+.ptlogin2.qq.com"
    #cn地址
    - "rule-set:cnsite"
    
proxy-groups:
  #规则匹配组
  - name: Default
    type: select
    proxies: [Auto, DIRECT]
    icon: https://raw.githubusercontent.com/Orz-3/mini/refs/heads/master/Color/Kuai.png
  - name: Auto
    type: url-test
    url: https://www.gstatic.com/generate_204
    tolerance: 20
    interval: 300
    proxies: []
    icon: https://raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/Speedtest.png
  - name: Relay
    type: select
    proxies: [DIRECT]
    icon: https://raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/TestFlight.png
  - name: PayPal
    type: select
    proxies: [Default, Auto, DIRECT]
    icon: https://raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/PayPal.png
  - name: AI-Service
    type: select
    proxies: [Default, Auto, DIRECT]
    icon: https://raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/ChatGPT.png
  - name: TikTok
    type: select
    proxies: [Default, Auto, DIRECT]
    icon: https://raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/TikTok.png
  - name: Streaming-Media
    type: select
    proxies: [Default, Auto, DIRECT]
    icon: https://raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/Netflix.png
  - name: Telegram
    type: select
    proxies: [Default, Auto, DIRECT]
    icon: https://raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/Telegram.png
  - name: Instagram
    type: select
    proxies: [Default, Auto, DIRECT]
    icon: https://raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/Instagram.png
  - name: us-auto
    filter: "(?i)美|us|unitedstates|united states"
    type: url-test
    url: https://www.gstatic.com/generate_204
    tolerance: 20
    interval: 300
    proxies: []
    icon: https://raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/United_States.png
  - name: japan-auto
    filter: "(?i)日|jp|japan"
    type: url-test
    url: https://www.gstatic.com/generate_204
    tolerance: 20
    interval: 300
    proxies: []
    icon: https://raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/Japan.png
  - name: korea-auto
    filter: "(?i)韩|kr|korea"
    type: url-test
    url: https://www.gstatic.com/generate_204
    tolerance: 20
    interval: 300
    proxies: []
    icon: https://raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/Korea.png    

rule-providers:
  cnip:
    type: http
    behavior: ipcidr
    format: mrs
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geoip/cn.mrs"
    path: ./ruleset/cnip.mrs
    interval: 86400
  cnsite:
    type: http
    behavior: domain
    format: mrs
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/cn.mrs"
    path: ./ruleset/cnsite.mrs
    interval: 86400
  cngame:
    type: http
    behavior: domain
    format: mrs
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/category-games-!cn@cn.mrs"
    path: ./ruleset/cngame.mrs
    interval: 86400
  gfw:
    type: http
    behavior: domain
    format: mrs
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/gfw.mrs"
    path: ./ruleset/gfw.mrs
    interval: 86400
  aiservice:
    type: http
    behavior: domain
    format: mrs
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/category-ai-!cn.mrs"
    path: ./ruleset/aiservice.mrs
    interval: 86400
  paypal:
    type: http
    behavior: domain
    format: mrs
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/paypal.mrs"
    path: ./ruleset/paypal.mrs
    interval: 86400
  tiktok:
    type: http
    behavior: domain
    format: mrs
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/tiktok.mrs"
    path: ./ruleset/tiktok.mrs
    interval: 86400
  telegramsite:
    type: http
    behavior: domain
    format: mrs
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/telegram.mrs"
    path: ./ruleset/telegramsite.mrs
    interval: 86400
  telegramip:
    type: http
    behavior: ipcidr
    format: mrs
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geoip/telegram.mrs"
    path: ./ruleset/telegramip.mrs
    interval: 86400
  instagram:
    type: http
    behavior: domain
    format: mrs
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/instagram.mrs"
    path: ./ruleset/instagram.mrs
    interval: 86400
  netflixsite:
    type: http
    behavior: domain
    format: mrs
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/netflix.mrs"
    path: ./ruleset/netflixsite.mrs
    interval: 86400
  netflixip:
    type: http
    behavior: ipcidr
    format: mrs
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geoip/netflix.mrs"
    path: ./ruleset/netflixip.mrs
    interval: 86400
  disney:
    type: http
    behavior: domain
    format: mrs
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/disney.mrs"
    path: ./ruleset/disney.mrs
    interval: 86400
  hbo:
    type: http
    behavior: domain
    format: mrs
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/hbo.mrs"
    path: ./ruleset/hbo.mrs
    interval: 86400
  hulu:
    type: http
    behavior: domain
    format: mrs
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/hulu.mrs"
    path: ./ruleset/hulu.mrs

rules:
  #个人小众需求
  - DST-PORT,3478,DIRECT
  - DST-PORT,5201,DIRECT
  - DOMAIN-SUFFIX,migucloud.com,DIRECT
  - DOMAIN-SUFFIX,ghfast.top,DIRECT
  - DOMAIN-SUFFIX,services.googleapis.cn,Default
  #分流规则
  - DOMAIN-SUFFIX,emby.bid,BlackCat-EMBY
  - DOMAIN-SUFFIX,emby.men,BlackCat-EMBY
  - DOMAIN-SUFFIX,emby.date,BlackCat-EMBY
  - DOMAIN-SUFFIX,emby.loan,BlackCat-EMBY
  - DOMAIN-SUFFIX,emby.trade,BlackCat-EMBY
  - DOMAIN-SUFFIX,uuuoo.cc,BlackCat-EMBY
  - DOMAIN-SUFFIX,trkp.cc,BlackCat-EMBY
  - RULE-SET,paypal,PayPal
  - RULE-SET,aiservice,AI-Service
  - RULE-SET,tiktok,TikTok
  - RULE-SET,telegramsite,Telegram
  - RULE-SET,instagram,Instagram
  - RULE-SET,netflixsite,Streaming-Media
  - RULE-SET,disney,Streaming-Media
  - RULE-SET,hbo,Streaming-Media
  - RULE-SET,hulu,Streaming-Media
    #以下均是核心规则
  - RULE-SET,cngame,DIRECT
  - RULE-SET,gfw,Default
    #ip规则置下减少dns查询
  - RULE-SET,telegramip,Telegram
  - RULE-SET,netflixip,Streaming-Media
  - RULE-SET,cnip,DIRECT
    #代理规则
  - MATCH,Default
